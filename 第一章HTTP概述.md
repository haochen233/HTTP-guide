# 1.3资源

## 1.3.1 媒体类型
因特网上有数千种不同的数据类型，HTTP 仔细地给每种要通过 Web 传输的对象都打上了名为 MIME 类型（MIME  type）的数据格式标签。

Web 服务器会为所有 HTTP 对象数据附加一个 MIME 类型当。Web浏览器从服务器中取回一个对象时，会去查看相关的 MIME 类型，看看它是否知道应该如何处理这个对象。大多数浏览器都可以处理数百种常见的对象类型：显示图片文件、解析并格式化 HTML 文件、通过计算机声卡播放音频文件，或者运行外部插件软件来处理特殊格式的数据。


### MIME类型
MIME类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。

示例：  
- HTML 格式的文本文档由 text/html 类型来标记
- 普通的 ASCII 文本文档由 text/plain 类型来标记。
- JPEG 格式的图片为  image/jpeg 类型。
- GIF 格式的图片为  image/gif 类型。
- Apple 的 QuickTime 电影为  video/quicktime 类型。
- 微软的 PowerPoint 演示文件为 application/vnd.ms-powerpoint 类型。

## 1.3.2 URI
每个web服务器资源都有一个名字。服务器资源名被称为统一资源标识符（Uniform Resource Identifier， URI），URI在世界范围内唯一标识并定位信息资源。

URI有两种形式，分别称为URL和URN。

## 1.3.3 URL
统一资源定位符（URL）是资源标识符最常见的形式。URL描述了一台特定服务器上某资源的特定位置。它们可以明确说明如何从一个精确、固定的位置获取资源。

例如：http://www.baidu.com/index.html

大部分URL都遵循一种标准格式，这种格式包含三个部分：
- URL的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型，上例中为HTTP协议
- 第二部分给出了服务器的因特网地址（如上例，www.baidu.com）
- 其余部分指定了Web服务器上的某个资源（如上例，/index.html）

> 现在几乎所有的URI都是URL。

## 1.3.4 URN
URI的第二种形式就是统一资源名（URN），仍处于试验阶段。URN与位置无关。

# 1.4 事务
一个 HTTP 事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是**通过**名为 HTTP 报文（HTTP message）的格式化数据块进行的。

## 1.4.1 方法
HTTP 支持几种不同的请求命令，这些命令被称为 HTTP 方法（HTTP method） 。每条 HTTP 请求报文都包含一个方法。这个方法会告诉服务器要执行什么动作。

常见的HTTP方法：

| HTTP方法 | 描述 |
| --- | --- |
| GET | 从服务器向客户端发送命名资源 | 
| PUT | 将来自客户端的数据存储到一个命名的服务器资源中去
| DELETE | 从服务器中删除命名资源 |
| POST | 将客户端数据发送到一个服务器网管应用程序 |
| HEAD | 仅发送命名资源响应中的HTTP首部 |

## 1.4.2 状态码
每条HTTP响应报文返回时都会携带一个状态码。状态码是一个三位数字的代码。告知客户端请求是否成功，或者是否需要采取其他动作。

常见的状态码： 
| HTTP状态码 | 描述 |
| --- | --- |
| 200 | OK。文档正确返回 |
| 302 | Redirect（重定向）。到其他地方去获取资源 | 
| 404 | Not Found，无法找到这个资源 | 

伴随着每个数字状态码，HTTP 还会发送一条解释性的“原因短语”文本，包含文本短语主要是为了进行描述，所有的处理过程使用的都是数字码。

> 可以将原因短语理解为状态码的日志或注释。

例如： 
   
    200 OK
    200 Document attached
    200 Success\
    200 All's cool, dude


## 1.4.3 Web页面中可以包含多个对象
应用程序完成一项任务时通常会发布多个 HTTP 事务。

一个“Web页面”通常并不是单个资源，而是一组资源的集合。

例如: csdn.net网页中，包含了大量的图片，每个图片的都是一个资源，甚至有处于其他服务器上的资源。

# 1.5 报文
HTTP 报文是由一行一行的简单字符串组成的HTTP 报文都是纯文本，不是二进制代码，所以人们可以很方便地对其进行读写。

从 Web 客户端发往 Web 服务器的 HTTP 报文称为请求报文（request message） 。从服务器发往客户端的报文称为响应报文（response message） ，此外没有其他类型的HTTP 报文。HTTP 请求和响应报文的格式很类似。


HTTP报文包括以下三个部分。

- 起始行  
报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况。
- 首部字段  
起始行后面有零个或多个首部字段。每个首部字段都包含一个名字和一个值，为了便于解析，两者之间用冒号（:）来分隔。首部以一个空行结束。添加一个首部字段和添加新行一样简单。
- 主体  
空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送给 Web 服务器的数据；响应主体中装载了要返回给客户端的数据。起始行和首部都是文本形式且都是结构化的，而主体则不同，主体中可以包含任意的二进制数据（比如图片、视频、音轨、软件程序） 。当然，主体中也可以包含文本。

# 1.6 连接
TTP 是个应用层协议。HTTP 无需操心网络通信的具体细节；它把联网的细节都交给了通用、可靠的因特网传输协议 TCP/IP。

TCP提供了：
- 无差错的数据传输
- 按序传输（数据总是会按照发送的顺序到达）
- 未分段的数据流（可以在任意时刻一任意尺寸将数据发送出去）

只要建立了 TCP 连接，客户端服务器之间的报文交换就不会丢失、不会被破坏，也不会在接收时出现错序了。

## 1.6.2 连接、IP地址及端口号
在 HTTP 客户端向服务器发送报文之前，需要用网际协议（Internet  Protocol，IP）地址（IP地址）和端口号在客户端和服务器之间建立一条 TCP/IP 连接。

在 TCP 中，你需要知道服务器的 IP 地址，以及与服务器上运行的特定软件相关的TCP 端口号。

但最初怎么获得 HTTP 服务器的 IP 地址和端口号呢？当然是通过 URL了！我们前面曾提到过，URL 就是资源的地址，所以自然能够为我们提供存储资源的机器的 IP 地址。我们来看几个 URL：

    http://www.baidu.com/index.html
    http://14.215.177.39:80/index.html
    http://www.baidu.com:80/index.html

第一个URL中没有端口号，默认使用80端口。   
第二个使用了机器的IP地址以及80端口  
第三个使用了文本形式的域名。可以通过过DNS服务器将域名转换为IP地址。


浏览器通过HTTP显示位于远端服务器中的某个简单HTML资源的：  

- 浏览器从URL中解析出服务器的主机名（域名）
- 浏览器将服务器的主机名转换成服务器的 IP 地址；
- 浏览器将端口号（如果有的话）从 URL 中解析出来；
- 浏览器建立一条与 Web 服务器的 TCP 连接；
- 浏览器向服务器发送一条 HTTP 请求报文；
- 服务器向浏览器回送一条 HTTP 响应报文；
- 关闭连接，浏览器显示文档。

## 1.6.3 一个使用Telnet的示例
可以通过 Telnet 程序直接与 Web 服务器进行对话。通过 Telnet 可以打开一条到某台机器上某个端口的 TCP 连接，然后直接向那个端口输入一些字符。Web 服务器会将 Telnet 程序作为一个 Web 客户端来处理，所有回送给 TCP 连接的数据都会显示在屏幕上。

示例，一个使用telnet的HTTP事务，获取www.baidu.com的index.html文档： 

```shell
#井号为用户输入的
#telnet www.baidu.com 80
Trying 14.215.177.38...
Connected to www.baidu.com.
Escape character is '^]'.
#GET /index.html HTTP/1.1
#Host: www.baidu.com
...
...
...
#然后就会返回整个响应
```

> 要明确的是，**Telnet** 可以很好地模拟 HTTP 客户端，但不能作为服务器使用。而且对 Telnet 做脚本自动化是很繁琐乏味的。如果想要更灵活的工具，可以去看看 nc（netcat） 。通过 nc 可以很方便地操纵基于 UDP 和 TCP 的流量（包括 HTTP） ，还可以为其编写脚本。

# 1.7 协议版本
现在使用的 HTTP 协议有几个版本。HTTP 应用程序要尽量强健地处理各种不同的HTTP 协议变体。目前仍在使用的版本如下： 
- HTTP/0.9  
HTTP 的 1991 原型版本称为 HTTP/0.9。这个协议有很多严重的设计缺陷，只应该用于与老客户端的交互。HTTP/0.9 只支持 GET 方法不支持多媒体内容的
MIME 类型。

- HTTP/1.0  
1.0 是第一个得到广泛使用的 HTTP 版本。HTTP/1.0 添加了版本号、各种 HTTP
首部、一些额外的方法，以及对多媒体对象的处理。HTTP/1.0 使得包含生动图
片的 Web 页面和交互式表格成为可能

- HTTP/1.0+  
其中很多特性，包括持久的 keep-alive 连接、虚拟主机支持，以及代理连接支持都被加入到 HTTP 之中，并成为非官方的事实标准。这种非正式的 HTTP 扩展版本通常称为 HTTP/1.0+。

- HTTP/1.1  
HTTP/1.1 重点关注的是校正 HTTP 设计中的结构性缺陷，明确语义，引入重要的性能优化措施，并删除一些不好的特性。对更复杂的 Web 应用程序和部署方式的支持。HTTP/1.1 是当前使用的 HTTP 版本。

- HTTP-NG（又名 HTTP/2.0）  
它重点关注的是性能的大幅优化，以及更强大的服务逻辑远程执行框架。HTTP-NG 的研究工作终止于 1998 年。

# 1.8 Web的结构组件
不只Web浏览器和Web服务器两个应用程序，还有其他比较重要的应用程序： 
- 代理  
位于客户端与服务器之间的HTTP中间实体

- 缓存  
HTTP 的仓库，使常用页面的副本可以保存在离客户端更近的地方。

- 网关  
连接其他应用程序的特殊Web服务器

- 隧道  
对HTTP通信报文进行盲转发的特殊代理

- Agent代理
发起自动HTTP请求的半智能Web客户端

# 1.8.1 代理
HTTP代理服务器，是Web安全、应用集成以及性能优化的重要组成模块。

代理位于客户端和服务器之间，接收所有客户端的 HTTP 请求，并将这些请求转发给服务器（可能会对请求进行修改之后转发） 。对用户来说，这些应用程序就是一个代理，代表用户访问服务器。

出于安全考虑，通常会将代理作为转发所有 Web 流量的可信任中间节点使用。代理还可以对请求和响应（流量）进行过滤。

例如：企业对下载的应用程序进行病毒检测。

# 1.8.2 缓存
Web缓存（Web cache）或代理缓存（proxy cache）是一种特殊的HTTP代理服务器，可以将经过代理传送的常用文档复制保存起来，下一个请求统一文档的客户端就可以享受缓存的私有副本所提供的服务了。

> 简单地说，就是如果你访问的文档代理服务器中有副本的话，就不去访问真实服务器了，直接从代理服务器下载文档。从代理服务器下载文档，会比从远程Web服务器下载快得多。HTTP 定义了很多功能，使得缓存更加高效。

## 1.8.3 网关
网关（gateway）是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于将 **HTTP 流量转换成其他的协议**。

例如：一个HTTP/FTP网关会通过HTTP请求接收对FTP URI的请求，但通过FTP协议来获取文档。得到的文档会被该网关封装成一条HTTP报文，发送给客户端。

步骤如下：

- Web客户端向HTTP/FTP网关发起HTTP请求（里面是FTP URI的请求）
- HTTP/FTP网关使用FTP协议从FTP服务器获取请求的文档
- HTTP/FTP网关将文档封装成一条HTTP报文，发送给客户端。

## 1.8.4 隧道
隧道（tunnel）是建立起来之后，就会两条连接之间对原始数据进行盲转发的HTTP 应用程序。HTTP 隧道通常用来在一条或多条 HTTP 连接上转发非 HTTP 数据，转发时不会窥探数据。

## 1.8.5 Agent代理
用户 Agent 代理（或者简称为 Agent 代理）是代表用户发起 HTTP 请求的客户端程序。所有发布 Web 请求的应用程序都是 HTTP Agent 代理。到目前为止，我们只提到过一种 HTTP Agent 代理：Web 浏览器，但用户 Agent 代理还有很多其他类型。

> 比如，有些自己会在 Web 上闲逛的自动用户 Agent 代理，可以在无人监视的情况下发布 HTTP 事务并获取内容。这些自动代理的名字通常都很生动，比如“网络蜘蛛”（spiders）或者“Web 机器人” （Web  robots） 。网络蜘蛛会在 Web 上闲逛，搜集信息以构建有效的 Web 内容档案。